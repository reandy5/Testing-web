<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-N6HN27QS');</script>
<!-- End Google Tag Manager -->
  <meta charset="UTF-8" />
  <title>Checkout</title>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N6HN27QS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  <h1>Halaman Checkout</h1>
  <div id="cart-items"></div>
  <button onclick="purchase()">Bayar</button>

  <script>
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function renderCart() {
      const el = document.getElementById("cart-items");
      if (cart.length === 0) {
        el.innerHTML = "<p>Keranjang kosong.</p>";
        return;
      }
      el.innerHTML = "<ul>" + cart.map(item => `<li>${item.item_name} - Rp ${item.price}</li>`).join('') + "</ul>";
    }

    window.dataLayer = window.dataLayer || [];
    if (cart.length > 0) {
      const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      window.dataLayer.push({
        event: "begin_checkout",
        ecommerce: {
          currency: "IDR",
          value: total,
          items: cart
        }
      });
    }

    function purchase() {
      if (cart.length === 0) {
        alert("Keranjang kosong.");
        return;
      }

      const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      window.dataLayer.push({
        event: "purchase",
        ecommerce: {
          transaction_id: Date.now().toString(),
          currency: "IDR",
          value: total,
          items: cart
        }
      });

      localStorage.removeItem("cart");
      cart = [];
      alert("Pembayaran berhasil!");
      renderCart();
    }

    renderCart();
  </script>
</body>
</html>
